<Sysmon schemaversion="4.30">
   <EventFiltering>
 <RuleGroup name="" groupRelation="or">
      <RegistryEvent onmatch="include">
				<!--ADDITIONAL REFERENCE: [ http://www.ghacks.net/2016/06/04/windows-automatic-startup-locations/ ] -->
				<!--ADDITIONAL REFERENCE: [ https://view.officeapps.live.com/op/view.aspx?src=https://arsenalrecon.com/downloads/resources/Registry_Keys_Related_to_Autorun.ods ] -->
				<!--ADDITIONAL REFERENCE: [ http://www.silentrunners.org/launchpoints.html ] -->
			<TargetObject name="tactic_id=TA0003,TA0004,tactic_name=Persistence, Privilege Escalation,technique_id=T1547,technique_name=Boot or Logon Autostart Execution,subtechnique_id=T1547.001,subtechnique_name=Registry Run Keys / Start Folder" condition="contains">\CurrentVersion\Run</TargetObject><!--Microsoft:Windows: Run keys, incld RunOnce, RunOnceEx, RunServices, RunServicesOnce [Also covers terminal server] -->
			<TargetObject condition="contains">\Group Policy\Scripts</TargetObject> <!--Microsoft:Windows: Group policy scripts-->
			<TargetObject name="tactic_id=TA0003,TA0004,tactic_name=Persistence, Privilege Escalation,technique_id=T1037,technique_name=Boot or Logon Initialization Scripts" condition="contains">\Windows\System\Scripts</TargetObject> <!--Microsoft:Windows: Logon, Loggoff, Shutdown-->
			<TargetObject name="tactic_id=TA0003,TA0004,tactic_name=Persistence, Privilege Escalation,technique_id=T1547,technique_name=Boot or Logon Autostart Execution,subtechnique_id=T1547.001,subtechnique_name=Registry Run Keys / Start Folder" condition="contains">\Policies\Explorer\Run</TargetObject><!--Microsoft:Windows -->
			<TargetObject condition="end with">\ServiceDll</TargetObject> <!--Microsoft:Windows: Points to a service's DLL [ https://blog.cylance.com/windows-registry-persistence-part-1-introduction-attack-phases-and-windows-services ] -->
			<TargetObject condition="end with">\ImagePath</TargetObject> <!--Microsoft:Windows: Points to a service's EXE [ https://github.com/crypsisgroup/Splunkmon/blob/master/sysmon.cfg ] -->
			<TargetObject condition="end with">\Start</TargetObject> <!--Microsoft:Windows: Services start mode changes (Disabled, Automatically, Manual)-->
			<TargetObject name="tactic_id=TA0003,TA0004,tactic_name=Persistence, Privilege Escalation,technique_id=T1543,technique_name=Create or Modify System Process,subtechnique_id=T1543.003,subtechnique_name=Windows Service" condition="end with">\ServiceManifest</TargetObject> <!--Windows: Manifest pointing to service's DLL [ https://www.geoffchappell.com/studies/windows/win32/services/svchost/index.htm ] -->
			<TargetObject name="tactic_id=TA0003,TA0004,tactic_name=Persistence, Privilege Escalation,technique_id=T1547,technique_name=Boot or Logon Autostart Execution,subtechnique_id=T1547.004,subtechnique_name=Winlogon Helper DLL" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Notify</TargetObject><!--Microsoft:Windows: Autorun location [ https://www.cylance.com/windows-registry-persistence-part-2-the-run-keys-and-search-order ] -->
			<TargetObject name="tactic_id=TA0003,TA0004,tactic_name=Persistence, Privilege Escalation,technique_id=T1547,technique_name=Boot or Logon Autostart Execution,subtechnique_id=T1547.004,subtechnique_name=Winlogon Helper DLL" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Userinit</TargetObject> <!--Microsoft:Windows: Autorun location [ https://www.cylance.com/windows-registry-persistence-part-2-the-run-keys-and-search-order ] -->
      <TargetObject name="tactic_id=TA0003,TA0004,tactic_name=Persistence, Privilege Escalation,technique_id=T1547,technique_name=Boot or Logon Autostart Execution,subtechnique_id=T1547.004,subtechnique_name=Winlogon Helper DLL" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Shell</TargetObject>
			<TargetObject condition="begin with">HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows NT\CurrentVersion\Drivers32</TargetObject> <!--Microsoft:Windows: Legacy driver loading | Credit @ion-storm -->
			<TargetObject name="tactic_id=TA0003,TA0004,tactic_name=Persistence, Privilege Escalation,technique_id=T1547,technique_name=Boot or Logon Autostart Execution,subtechnique_id=T1547.001,subtechnique_name=Registry Run Keys / Start Folder" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\BootExecute</TargetObject> <!--Microsoft:Windows: Autorun | Credit @ion-storm | [ https://www.cylance.com/windows-registry-persistence-part-2-the-run-keys-and-search-order ] -->
			<TargetObject name="tactic_id=TA0004,TA0003,tactic_name=Privilege Escalation, Persistence,tactic_id=TA0004,TA0003,tactic_name=Privilege Escalation, Persistence,technique_id=T1546,technique_name=Event Triggered Execution,subtechnique_id=T1546.001,subtechnique_name=Change Default File Association" condition="contains">\Explorer\FileExts</TargetObject><!--Microsoft:Windows: Changes to file extension mapping-->
			<TargetObject condition="contains">\shell\install\command</TargetObject> <!--Microsoft:Windows: Sensitive subkey under file associations and CLSID that map to launch command-->
			<TargetObject condition="contains">\shell\open\command</TargetObject> <!--Microsoft:Windows: Sensitive subkey under file associations and CLSID that map to launch command-->
			<TargetObject condition="contains">\shell\open\ddeexec</TargetObject> <!--Microsoft:Windows: Sensitive subkey under file associations and CLSID that map to launch command-->
			<TargetObject name="tactic_id=TA0003,TA0004,tactic_name=Persistence, Privilege Escalation,technique_id=T1547,technique_name=Boot or Logon Autostart Execution,subtechnique_id=T1547.001,subtechnique_name=Registry Run Keys / Start Folder" condition="contains">Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders\Startup</TargetObject>
			<TargetObject name="tactic_id=TA0003,TA0004,tactic_name=Persistence, Privilege Escalation,technique_id=T1547,technique_name=Boot or Logon Autostart Execution,subtechnique_id=T1547.001,subtechnique_name=Registry Run Keys / Start Folder" condition="contains">CurrentVersion\Windows\Load</TargetObject> <!--Windows: [ https://msdn.microsoft.com/en-us/library/jj874148.aspx ] -->
			<TargetObject name="tactic_id=TA0003,TA0004,tactic_name=Persistence, Privilege Escalation,technique_id=T1547,technique_name=Boot or Logon Autostart Execution,subtechnique_id=T1547.001,subtechnique_name=Registry Run Keys / Start Folder" condition="contains">CurrentVersion\Windows\Run</TargetObject> <!--Windows: [ https://msdn.microsoft.com/en-us/library/jj874148.aspx ] -->
			<TargetObject name="tactic_id=TA0003,TA0004,tactic_name=Persistence, Privilege Escalation,technique_id=T1547,technique_name=Boot or Logon Autostart Execution,subtechnique_id=T1547.001,subtechnique_name=Registry Run Keys / Start Folder" condition="contains">CurrentVersion\Winlogon\Shell</TargetObject> <!--Windows: [ https://msdn.microsoft.com/en-us/library/ms838576(v=winembedded.5).aspx ] -->
			<TargetObject name="tactic_id=TA0003,TA0004,tactic_name=Persistence, Privilege Escalation,technique_id=T1547,technique_name=Boot or Logon Autostart Execution,subtechnique_id=T1547.001,subtechnique_name=Registry Run Keys / Start Folder" condition="contains">CurrentVersion\Winlogon\System</TargetObject> <!--Windows [ https://www.exterminate-it.com/malpedia/regvals/zlob-dns-changer/118 ] -->
			<TargetObject condition="begin with">HKLM\Software\Microsoft\Windows NT\CurrentVersion\AeDebug</TargetObject> <!--Windows: Automatic program crash debug program [ https://www.symantec.com/security_response/writeup.jsp?docid=2007-050712-5453-99&tabid=2 ] -->
		</RegistryEvent>
</RuleGroup>
</EventFiltering>
</Sysmon>
